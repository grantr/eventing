apiVersion: v1
kind: Pod
metadata:
  name: broker-latency
  namespace: perf-eventing
  labels:
    role: broker-latency-consumer
spec:
  serviceAccountName: default
  restartPolicy: Never
  containers:
    - name: "broker-latency"
      image: knative.dev/eventing/test/test_images/latencymako
      resources:
        requests:
          cpu: 1000m
          memory: 1Gi
      ports:
        - containerPort: 8080
      args:
        - "--sink=http://default-broker.perf-eventing.svc.cluster.local"
        - "--tags=branch=latency_vegeta"
        - "--duration=60"
      volumeMounts:
        - name: config-mako
          mountPath: /etc/config-mako
      terminationMessagePolicy: FallbackToLogsOnError
    - name: "mako"
      image: gcr.io/knative-performance/mako-microservice:latest
      #image: knative.dev/pkg/test/mako/stub-sidecar
      env:
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /var/secret/robot.json
      volumeMounts:
      - name: mako-upload
        mountPath: /var/secret
  volumes:
  - name: mako-upload
    secret:
      secretName: mako-upload
  - name: config-mako
    configMap:
      name: config-mako
